{
  "hash": "2c34a9fcaea37a524846cc7cf8525588",
  "result": {
    "markdown": "---\ntitle: \"Relationship between chlorophyll-a and nutrients in the Santa Barbara Channel\"\ndescription: \"Characterizing a statistically significant overall relationship between chlorophyll-a and phosphate and dissolved inorganic nitrogen.\"\nauthor: \n  - name: Amanda Herbst\n    url: https://amandaherbst.github.io/\n    affiliation: MEDS\n    affiliation-url: https://bren.ucsb.edu/masters-programs/master-environmental-data-science/academics-meds\ndate: 10-23-2023\ncategories: [Quarto, MEDS, Statistics, Regression Model, R]\nbibliography: references.bib\ncitation:\n  url: https://amandaherbst.github.io/blog/2023-12-15-eds222-chl-nutrients/\nimage: sb_coast.JPG\ndraft: false\nexecute:\n  warning: FALSE\n  messages: FALSE\nformat:\n    html:\n        code-fold: true\n---\n\n\n# Relationship between cholorphyll-*a* and nutrients in the Santa Barbara Channel\n\n![Santa Barbara Coast](sb_coast.JPG)\n\n## Background\n\nPhytoplankton play a key role in both oceanic food webs and the global\ncarbon cycle. Although they only make up 0.2% of the global primary\nproducer biomass, phytoplankton are responsible for nearly half of\nEarth's primary production (Field et al 1998). Every marine organism\nrelies on phytoplankton directly or indirectly for fuel and through\nphotosynthesis, phytoplankton convert inorganic carbon, CO2, into\norganic carbon. It is then essential to study them to understand how\nthey can mitigate and/or be affected by climate change. Since all\nphotosynthetically active phytoplankton use chlorophyll-*a*\npigment to produce their own fuel, chlorophyll-*a* is commonly used as a proxy for\nphytoplankton biomass.\n\nIn order to grow and thrive, phytoplankton rely on certain\nnutrients--phosphate (PO4) and dissolved inorganic nitrogen (nitrate,\nnitrite, ammonium). It has been proven that on short timescales, such as\nweeks and months, the previously mentioned nutrients are dominant\ndrivers of changes in chlorophyll-*a* concentration, with a directly\nproportional relationship (Blauw et al 2018).\n\nCoastal ocean waters are teeming with life and are more productive\ncompared to the open ocean, but are also most vulnerable to climate\nchange (Sigman and Hain 2012). By growing our understanding of the\nchemistry and biology in these coastal areas, we can better protect and\npredict future changes due to climate change and ocean acidification.\n\nWhile learning about the close relationship between chlorophyll-*a* and\nnutrients, I began to wonder if, with a large enough dataset, a\nstatistically significant relationship could be characterized. I knew\nthat my hometown, Santa Barbara, had a Long-Term Ecological Research\nproject with years worth of open access coastal chemistry and nutrient\ndata, so I set out to answer this question with their data.\n\n## Data\n\nThe Santa Barbara Coastal Long-Term Ecological Research program has been\nconducting monthly nearshore cruises along the Santa Barbra channel at\n16 sites since 2000. Water samples are collected with a rosette sampler\nand multiple nutrients and water chemistry parameters are measured. The data\nare accessible to anyone on the Environmental Data Initiative or DataOne websites. Included in this dataset are measurements of\nchlorophyll-a, phosphate, nitrate, nitrite, and ammonium concentrations,\nwhich I used for my analysis.\n\n![SBC LTER sampling locations](sbc_lter_sample_locations.png)\n\n## Methods\n\n\n::: {.cell}\n\n:::\n\n\n### Data loading, cleaning, and preparation\n\nI imported the data via a URL leading to the DataOne website, but it could also be downloaded and stored locally.\n\nInitial data cleaning was done in the same step as\nimporting by piping. The initial data frame was relatively tidy, but needed certain values to be replaced with NAs: any 99999 values where data was missing and nutrient measurements labeled \"BDL\" for below detection level. \n\nSince chlorophyll-*a* concentration is driven by phosphate and\n*dissolved inorganic nitrogen*, a new column was created with the sum of the components of dissolved inorganic nitrogen: nitrite, nitrate and ammonium. For more accurate sum totals, an intermediate data frame was created in order to convert the NA values to 0. Once the sums were calculated, any sums equaling zero were converted back to NAs and the dissolved inorganic nitrogen column was added via `cbind()` back to the original data frame. Lastly, a new dataframe was created with only the necessary variables for more efficient handling.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbottle <- read_delim(\"https://cn.dataone.org/cn/v2/resolve/https%3A%2F%2Fpasta.lternet.edu%2Fpackage%2Fdata%2Feml%2Fknb-lter-sbc%2F10%2F27%2F572816525903a898f686df5b64eb3852\",\n                     # BDL = below detection limit, so convert those to NA\n                     na = \"BDL\",\n                     show_col_types = FALSE) %>% \n  clean_names() %>% \n  # convert any 99999 value to NA values \n  replace_with_na_all(condition = ~.x == 99999) %>% \n  # two rows at station Q2 which is not in the meta data and a positive longitude...\n  filter(station != \"Q2\")\n# problems(bottle)\n# bottle <- read_delim(here(\"data\", \"LTER_monthly_bottledata_20220930.txt\"), \n                     # BDL = below detection limit, so convert those to NA\n                    # na = \"BDL\") %>% \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# select preferred nitrogen columns\nbottle_nutrients <- bottle %>% \n  select(no2_no3_umol_l, ammonia_umol_l)\n\n# convert any NAs to 0 for more accurate sums\nbottle_nutrients[is.na(bottle_nutrients)] <- 0\n\n# create column DIN as sum of the nitrogen components\nbottle_nutrients <- bottle_nutrients %>% \n  mutate(din_umol_l = no2_no3_umol_l + ammonia_umol_l)\n\n# convert and 0s back to NA\nbottle_nutrients$din_umol_l[bottle_nutrients$din_umol_l == 0] <- NA\n\n# create the data frame we want by adding DIN column and only selecting chl and nutrients\nbottle_complete <- bottle %>% \n  cbind(din_umol_l = bottle_nutrients$din_umol_l) %>% \n  select(chl_a_ug_l, po4_umol_l, din_umol_l)\n```\n:::\n\n\n### Data exploration\n\nThe plan was to run an ordinary least squares (OLS) multiple linear regression between chlorophyll-*a* and phosphate and dissolved inorganic nitrogen. Before proceeding, I explored the distribution of each of the variables and found that chlorophyll-*a* had some large outliers which created a positive skew and long right tail (Figure 1). In order to account for the outliers and lower the leverage of large values in the model, the log of chlorophyll-*a* concentration was used (Figure 2).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = bottle_complete) +\n  geom_histogram(aes(chl_a_ug_l), \n                 fill = \"darkgreen\", \n                 color = \"white\",\n                 bins = 50) +\n  labs(x = \"[Chlorophyll-a] (\\u03BCg/L)\",\n       y = \"Frequency\",\n       title = \"Chl-a Distribution\",\n       caption = \"Fig 1. Distribution of chlorophyll-a concentrations in coastal water samples.\") +\n  theme_bw() +\n  theme(plot.caption = element_text(hjust=0))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nA new column was added, the log of chlorphyll-*a* concentration, and was utilized in the following regression model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add log(chl-a) column\nbottle_complete <- bottle_complete %>% \n  mutate(log_chla = log(chl_a_ug_l))\n\n# check distributions again\nggplot(data = bottle_complete) +\n  geom_histogram(aes(log_chla), \n                 fill = \"darkgreen\", \n                 color = \"white\") +\n  labs(x = \"log[Chlorophyll-a]\",\n       y = \"Frequency\",\n       title = \"log(chl-a) Distribution\",\n       caption = \"Fig 2. Distribution of the log of chlorophyll-a concentration.\") +\n  theme_bw() +\n  theme(plot.caption = element_text(hjust=0)) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Regression\n\nNow that the log of chlorophyll-*a* concentration lowers the leverage of large values, multiple linear regression was implemented\nto answer my question. Nitrogen and phosphorous are co-limiting nutrients and phytoplankton rely on a certain ratio of nutrients for optimal growth -- which is known as the Redfield Ratio. Due to this, the response of phytoplankton to each nutrient can actually depend on the supply of the other (Frost et al 2023). Due to this phenomenon, an interaction term between phosphorous and dissolved inorganic nitrogen was included in the regression model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# multiple linear regression with interaction term\nmodel <- lm(log_chla ~ po4_umol_l + din_umol_l + din_umol_l:po4_umol_l, data = bottle_complete)\n\n# sjplot for clean output table\nsjPlot::tab_model(model, digits = 3, show.se = TRUE, \n                  title = \"Table 1. Summary of log-linear multiple regression model with interaction term.\", string.se = \"SE\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table style=\"border-collapse:collapse; border:none;\">\n<caption style=\"font-weight: bold; text-align:left;\">Table 1. Summary of log-linear multiple regression model with interaction term.</caption>\n<tr>\n<th style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; \">&nbsp;</th>\n<th colspan=\"4\" style=\"border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; \">log chla</th>\n</tr>\n<tr>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; \">Predictors</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">Estimates</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">SE</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">CI</td>\n<td style=\" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  \">p</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">(Intercept)</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.711</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.044</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.625&nbsp;&ndash;&nbsp;0.796</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">po4 umol l</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.482</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.150</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.777&nbsp;&ndash;&nbsp;-0.188</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">din umol l</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.069</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.013</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.042&nbsp;&ndash;&nbsp;0.095</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; \">po4 umol l × din umol l</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.037</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">0.008</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \">&#45;0.054&nbsp;&ndash;&nbsp;-0.020</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  \"><strong>&lt;0.001</strong></td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;\">Observations</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;\" colspan=\"4\">2473</td>\n</tr>\n<tr>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;\">R<sup>2</sup> / R<sup>2</sup> adjusted</td>\n<td style=\" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;\" colspan=\"4\">0.021 / 0.020</td>\n</tr>\n\n</table>\n\n`````\n:::\n:::\n\n\n### Coefficient Interpretations\n\nThis model produces a lot of outputs, so let's interpret what each coefficient value means:\n\n-   `(Intercept)`: the exponential of the intercept\n    (2.035) is the\n    predicted concentration of chlorophyll-*a* in ug/L when the\n    concentrations of both phosphate and dissolved inorganic nitrogen\n    are zero.\n-   `po4 umol l`: a one micro mole per liter increase in phosphate\n    changes the concentration of chlorophyll-*a* by\n    -48.2%, when there is no\n    dissolved inorganic nitrogen in the water.\n-   `din_umol_l`: a one micro mole per liter increase in dissolved\n    inorganic nitrogen changes the concentration of chlorophyll-*a* by\n    6.9%, when there is no\n    phosphate in the water.\n-   `po4 umol l x din umol l`: Since both parameters in the interaction\n    term are continuous variables, this coefficient describes the\n    marginal effect of both nutrients on each other's slope of their\n    relationship with log(chlorophyll-*a*):\n    -   effect of\n        phosphate:-0.48 +\n        -0.04\\*DIN\n    -   effect of nitrogen:\n        0.07 +\n        -0.04\\*PO4\n\n### Marginal effects\n\nSince the interaction is between two continuous variables, the slope of\none nutrient's relationship with chlorphyll-a is conditional on the\nconcentration of the other. This is called the marginal effect. We can actually plot\nthe marginal effects of phosphate and nitrogen on each other to better visualize:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndevtools::source_url(\"https://raw.githubusercontent.com/jkarreth/JKmisc/master/ggintfun.R\")\n\nggintfun(obj = model, varnames = c(\"po4_umol_l\", \"din_umol_l\"), \n         varlabs = c(\"Phosphate\", \"Dissolved Inorganic Nitrogen\"),\n         title = FALSE, rug = TRUE,\n         twoways = TRUE)\n```\n:::\n\n\n![Fig 3. Marginal effects of phosphate (left) and dissolved inorganic\nnitrogen (right)](marginal_effects.png) Fig 3. Marginal effects of\nphosphate (left) and dissolved inorganic nitrogen (right).\n\n## Discussion\n\nAll of the coeefficients of the regression model are significant at a significance level of $\\alpha = 0.01$ (Table 1). Therefore this relationship between chlorophyll-*a* and phosphate and dissolved inorganic nitrogen can be considered statistically significant. However, when investigating the relationship between the two nutrients, phosphate and dissolved inorganic nitrogen are colinear (Figure 4). Due to this, the coefficients in Table 1 must be considered with confidence because the model could be very sensitive to changes in the nutrient concentrations. Additionally, although the coefficients may appear significant, the adjusted $R^2$, 0.02, indicates that these nutrients explain very little of the total variability in chlorphyll-*a*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = bottle_complete, aes(x = din_umol_l, y = po4_umol_l)) +\n  geom_point(alpha = 0.5) +\n  labs(x = \"Dissolved Inorganic Nitrogen (\\u03BCmol/L)\",\n       y = \"Phosphate (\\u03BCmol/L)\",\n       caption = \"Fig 4. Relationship between measured dissolved inorganic nitrogen and phosphate demonstrating collinearity\") +\n  geom_smooth(method = lm, se = FALSE,\n              color = \"darkseagreen\") +\n  scale_x_continuous(expand = c(0, 0), limits = c(0, 25)) +\n  scale_y_continuous(expand = c(0,0), limits = c(0, 3)) +\n  theme_bw() +\n  theme(plot.caption = element_text(hjust = 0))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## Conclusion\n\nAlthough nutrients play a large role in chlorophyll-*a* concentration, and therefore phytoplankton biomass, there are other drivers with high importance including temperature and available light. Future work should include isolating and controlling for temperature and light availability to better characterize the relationship between chlorophyll-*a* and nutrients. Once a better model fit is constructed, further work could include investigating the affect of site and depth in the channel have on this relationship.\n\n## References\n\nBlauw, A. N., E. Benincà, R. W.P.M. Laane, N. Greenwood and J. Huisman.\n2018. Predictability and environmental drivers of chlorophyll\nfluctuations vary across different time scales and regions of the North\nSea. Progress in Oceanography **161**: 1-18. ISSN 0079-6611.\ndoi:10.1016/j.pocean.2018.01.005.\n\nField, C. B., M. J., Behrenfeld, J. T., Randerson, and P.\nFalkowski.1998. Primary production of the biosphere: Integrating\nterrestrial and oceanic components. Science **281**: 237-240.\ndoi:10.1126/science.281.5374.237\n\nFrost, P.C., Pearce, N.J.T., Berger, S.A., Gessner, M.O., Makower, A.K., Marzetz, V., Nejstgaard, J.C., Pralle, A., Schälicke, S., Wacker, A., Wagner, N.D. and Xenopoulos, M.A. (2023), Interactive effects of nitrogen and phosphorus on growth and stoichiometry of lake phytoplankton. Limnol Oceanogr, 68: 1172-1184. https://doi.org/10.1002/lno.12337\n\nSigman, D. M. & Hain, M. P. (2012) The Biological Productivity of the\nOcean. Nature Education Knowledge 3(10):21. https://www.nature.com/scitable/knowledge/library/the-biological-productivity-of-the-ocean-70631104/ Accessed December 15, 2023\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}